<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <link href=../img/favicon.ico rel="shortcut icon">
    <title>IGV - Dev</title>

    <!-- IGV CSS -->
    <link href="css/dev.css" rel="stylesheet" type="text/css"/>


</head>

<body>

<div>
    <button id="bmBtn">Bookmark</button>
</div>

<h3>Example tracks - click to load</h3>

<div id="trackList"></div>

<div id="igvDiv" style="padding-top: 50px;padding-bottom: 20px; height: auto"></div>

</body>

<script type="module">

    import igv from "../js/api.js";
    import google from "../js/google/googleUtils.js";

    let browser;

    (async () => {

        await google.loadGoogleProperties("https://s3.amazonaws.com/igv.org.app/web_client_google");

        const options =
            {
                genome: "hg19",
                // locus: [ 'egfr', 'myc' ],
                locus: "myc",
                flanking: 1000,
                queryParametersSupported: true,
                showAllChromosomes: true,
                showCursorTrackingGuide: true,
                showControls: true,
                // tracks:
                //     [
                //         {
                //             name: "BED Render Bug",
                //             url: 'https://www.encodeproject.org/files/ENCFF768ZWJ/@@download/ENCFF768ZWJ.bigBed'
                //         }
                //
                //     ]

            };

        browser = await igv.createBrowser(document.getElementById('igvDiv'), options);

        await createTrackList(document.getElementById('trackList'), 'testTracks.json', browser);

    })();

    async function createTrackList(div, file, browser) {

        const tracks = await igv.xhr.loadJson(file);

        for (let track of tracks) {

            if (track.HEADING) {
                div.insertAdjacentHTML("beforeend",
                    "<div style='cursor:default;background:lightgrey;color:black;margin-left:0; font-weight:bold;font-size: larger'>"
                    + track.HEADING + "</div>");
            } else {
                let trackDiv = document.createElement('div');
                trackDiv.innerHTML = track.name;
                trackDiv.addEventListener('click', async () => await browser.loadTrack(JSON.stringify(track)));
                div.appendChild(trackDiv);
            }

        }

        const json = await igv.GtexUtils.getTissueInfo("gtex_v7");

        div.insertAdjacentHTML("beforeend", "<div style='cursor:default;background:lightgrey;color:black;margin-left:0; font-weight:bold;font-size: larger'>GTEX</div>");

        for (let obj of json['tissueInfo']) {
            let trackDiv = document.createElement('div');
            trackDiv.innerHTML = (obj.tissueSiteDetailId.split('_').join(' '));
            trackDiv.addEventListener('click', async () => await browser.loadTrack(igv.GtexUtils.trackConfiguration(obj)));
            div.appendChild(trackDiv)
        }

    }

    function bookmark() {
        window.history.pushState({}, "IGV", browser.sessionURL());
    }

    document.getElementById("bmBtn").addEventListener("click", bookmark);

</script>
</html>
